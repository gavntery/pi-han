<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
   <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
   <title>PixInsight Reference Documentation | SubframeSelector</title>
   <meta name="keywords" content="subframe evaluation, subframe selection, subframe weighting, star detection, star fitting, star profile full width at half maximum, FWHM, star profile eccentricity, subframe signal to noise ratio weight" />
   <meta name="author" content="Mike Schuster" />
   <meta name="description" content="Facilitates subframe evaluation, selection and weighting based on several subframe quality related measurements." />
   <meta name="robots" content="INDEX,FOLLOW" />
   <meta name="generator" content="PixInsight Documentation Compiler script version 1.6.3" />
   <script type="text/javascript" src="../../pidoc/scripts/pidoc-utility.js"></script>
   <link type="text/css" href="../../pidoc/css/pidoc-common.css" rel="stylesheet" />
   <link type="text/css" href="../../pidoc/css/pidoc-highlight.css" rel="stylesheet" />
   <link type="text/css" href="../../pidoc/css/pidoc-tool.css" rel="stylesheet" />
   <link rel="icon" href="../../pidoc/icons/pidoc-icon.png" type="image/png" />
   <link rel="shortcut icon" href="../../pidoc/icons/pidoc-icon.png" type="image/png" />
</head>
<body>
<script type="text/javascript">
   pidoc_generateDynamicContents();
</script>

<h1>SubframeSelector</h1>

<div id="authors">
<p>By Mike Schuster</p>
</div>

<hr class="separator"/>

<div id="brief">
<p>Facilitates subframe evaluation, selection and weighting based on several subframe quality related measurements. <a href="#__contents__">[more]</a></p></div>

<div id="keywords">
<p><strong>Keywords:</strong> subframe evaluation, subframe selection, subframe weighting, star detection, star fitting, star profile full width at half maximum, FWHM, star profile eccentricity, subframe signal to noise ratio weight</p>
</div>

<h3 class="pidoc_sectionTitle" id="__toc__">Contents</h3>
<p class="pidoc_sectionToggleButton" onclick="pidoc_toggleSection( 'toc', this );">[hide]</p>
<div id="toc">
<ul>
<li class="pidoc_tocItem"><a href="#__Description__">1&emsp;Description</a>
<ul>
<li class="pidoc_tocSubitem"><a href="#__Description_:_Measurement_and_Presentation__">1.1&emsp;Measurement and Presentation</a></li>
<li class="pidoc_tocSubitem"><a href="#__Description_:_Subframe_Approval__">1.2&emsp;Subframe Approval</a></li>
<li class="pidoc_tocSubitem"><a href="#__Description_:_Subframe_Weighting__">1.3&emsp;Subframe Weighting</a></li>
<li class="pidoc_tocSubitem"><a href="#__Description_:_Output_Subframes__">1.4&emsp;Output Subframes</a></li>
<li class="pidoc_tocSubitem"><a href="#__Description_:_Output_Subframe_Star_Maps__">1.5&emsp;Output Subframe Star Maps</a></li>
<li class="pidoc_tocSubitem"><a href="#__Description_:_Subframe_Properties__">1.6&emsp;Subframe Properties</a></li>
<li class="pidoc_tocSubitem"><a href="#__Description_:_Subframe_Expressions__">1.7&emsp;Subframe Expressions</a></li>
<li class="pidoc_tocSubitem"><a href="#__Description_:_Subframe_Approval_Expression__">1.8&emsp;Subframe Approval Expression</a></li>
<li class="pidoc_tocSubitem"><a href="#__Description_:_Subframe_Weighting_Expression__">1.9&emsp;Subframe Weighting Expression</a></li>
</ul>
</li>
<li class="pidoc_tocItem"><a href="#__Usage__">2&emsp;Usage</a>
<ul>
<li class="pidoc_tocSubitem"><a href="#__Usage_:_Target_Subframes__">2.1&emsp;Target Subframes</a></li>
<li class="pidoc_tocSubitem"><a href="#__Usage_:_System_Parameters__">2.2&emsp;System Parameters</a></li>
<li class="pidoc_tocSubitem"><a href="#__Usage_:_Star_Detection_and_Fitting__">2.3&emsp;Star Detection and Fitting</a></li>
<li class="pidoc_tocSubitem"><a href="#__Usage_:_Expressions__">2.4&emsp;Expressions</a></li>
<li class="pidoc_tocSubitem"><a href="#__Usage_:_Table__">2.5&emsp;Table</a></li>
<li class="pidoc_tocSubitem"><a href="#__Usage_:_Plots__">2.6&emsp;Plots</a></li>
<li class="pidoc_tocSubitem"><a href="#__Usage_:_Output__">2.7&emsp;Output</a></li>
<li class="pidoc_tocSubitem"><a href="#__Usage_:_Measure__">2.8&emsp;Measure</a></li>
<li class="pidoc_tocSubitem"><a href="#__Usage_:_Output_Subframes__">2.9&emsp;Output Subframes</a></li>
<li class="pidoc_tocSubitem"><a href="#__Usage_:_Output_Maps__">2.10&emsp;Output Maps</a></li>
<li class="pidoc_tocSubitem"><a href="#__Usage_:_Reset__">2.11&emsp;Reset</a></li>
<li class="pidoc_tocSubitem"><a href="#__Usage_:_Dismiss__">2.12&emsp;Dismiss</a></li>
</ul>
</li>
<li class="pidoc_tocItem"><a href="#__references__">References</a></li>
<li class="pidoc_tocItem"><a href="#__relatedTools__">Related Tools</a></li>
</ul>
</div>

<div id="__contents__">

<div class="pidoc_section" id="__Description__">
   <h3 class="pidoc_sectionTitle">1&emsp;Description</h3>
   <p class="pidoc_sectionToggleButton" onclick="pidoc_toggleSection( 'Description', this );">[hide]</p>
   <div id="Description">
<img src="images/SubframeSelector.png" alt=""/>
<p>The SubframeSelector script facilitates subframe evaluation, selection and weighting based on several subframe quality related measurements, including estimates of star profile <a href="#subframe_property_FWHM"><em>full width at half maximum</em></a> (FWHM), star profile <a href="#subframe_property_Eccentricity"><em>eccentricity</em></a> and subframe <a href="#subframe_property_SNRWeight"><em>signal to noise ratio weight</em></a>.</p>
<p>SubframeSelector provides the following functions:</p>

<ul class="pidoc_list">
<li><a href="#measurement_and_presentation">Measurement and presentation</a> of subframe quality related <a href="#Subframe_Properties">properties</a>, with the option of saving the measurements in a <em>comma separated value</em> .csv file for postprocessing. This facility is intended to help with subframe quality evaluation.</li>
<li>A <a href="#subframe_approval">subframe approval facility</a>, with the option of copying/moving the approved/rejected subframes to output directories for postprocessing. Choosing a subset of subframes that meet certain quaility requirements for integration is an example usage of this facility.</li>
<li>A <a href="#subframe_weighting">subframe weighting facility</a>, with the option of recording subframe weights in FITS headers for postprocessing. Assigning integration weights to subframes is an example usage of this facility. Another example is the determination of the &quot;best&quot; subframe for use as a registration reference.</li>
</ul>

<p>SubframeSelector relies on the PixInsight <a href="../../tools/StarAlignment/StarAlignment.html" title="../../tools/StarAlignment/StarAlignment.html">StarAlignment</a> process for star detection, the PixInsight <a href="../../tools/DynamicPSF/DynamicPSF.html" title="../../tools/DynamicPSF/DynamicPSF.html">DynamicPSF</a> process for star fitting, and PixInsight's multiresolution support noise estimation capabilites<sup><a href="#__reference_1__" class="pidoc_referenceTooltip" onmouseover="pidoc_showReferenceToolTip( this );" onmouseout="pidoc_hideReferenceToolTip();" data-tooltip="[Reference 1]<br/>
Jean-Luc Starck and Fionn Murtagh, <em>Automatic Noise Estimation from the Multiresolution Support</em>, Publications of the Royal Astronomical Society of the Pacific, vol. 110, February 1998, pp. 193-199">[1]</a></sup>. The script employs custom algorithms for data reduction and presentation. The subframe selection and weighting facilities rely on a custom <a href="#subframe_expressions">subframe expression</a> parser and interpreter.</p>
<div class="pidoc_subsection" id="__Description_:_Measurement_and_Presentation__">
   <h4 class="pidoc_subsectionTitle">1.1&emsp;<a id="measurement_and_presentation"></a>Measurement and Presentation</h4>
<img src="images/TargetSubframes.png" alt=""/>
<p>In the <a href="#Target_Subframes_section">Target Subframes</a> section, add all target subframes. Subframes may be raw, calibrated or registered, but all should be the same type, have their overscan regions (if any) applied and cropped, be compatible for registration (if unregistered) and be compatible for integration. Measurements are typically most accurate on calibrated but unregistered subframes.</p>
<p>All subframes should be observations of the same target. Small variations in targeting are acceptable, such as those due to dithering and meridian flipping. Larger variations in targeting will result in incomparable property measurements.</p>
<p>Add at most several hundred subframes. Adding more than that may result in poor performance of the script.</p>
<img src="images/SystemParameters.png" alt=""/>
<p>Set the parameters in the <a href="#System_Parameters_section">System Parameters</a> section.</p>
<img src="images/StarDetectionandFitting.png" alt=""/>
<p>Adjust the <a href="#Star_Detection_and_Fitting_section">Star Detection and Fitting</a> section parameters if necessary so that between several hundred and several thousand stars are detected and fitted per subframe. The number of stars detected and fitted per subframe is provided by the <a href="#subframe_property_StarSupport">StarSupport</a> property once the measurement process has completed. A map of detected and fitted stars in each subframe may also be generated by clicking the <a href="#Output_Maps_button">Output Maps</a> button.</p>
<p>Select a <a href="#Star_Detection_and_Fitting_Point_spread_function">Point spread function</a> (PSF). The PSF functions are defined in the <a href="../../tools/DynamicPSF/DynamicPSF.html" title="../../tools/DynamicPSF/DynamicPSF.html">DynamicPSF</a> process documentation. Star images will be fit to the selected PSF model. The quality of the fit on each subframe is provided by the <a href="#subframe_property_StarResidual">StarResidual</a> and <a href="#subframe_property_StarResidualMeanDev">StarResidualMeanDev</a> properties once the measurement process has completed. A map of residuals for each fitted star in each subframe may also be generated by clicking the <a href="#Output_Maps_button">Output Maps</a> button.</p>
<img src="images/MeasureButton.png" alt=""/>
<p>Click the <a href="#Measure_button">Measure</a> button. Review the measurements presented in the table and the plots.</p>
<img src="images/TableTopLeftAll.png" alt=""/>
<p>The table contains one row per subframe with the subframe's <a href="#subframe_property_Index">Index</a> and file name listed in the first column and its <a href="#Subframe_Properties">subframe properties</a> listed in the remaining columns. The table may be sorted by column by selecting a <a href="#Table_Sort_table_by_column">table sort column</a> and a <a href="#Table_Sort_Table_by_ordering">table sort ordering</a>.</p>
<p>The table may be saved as a <em>comma separated value</em> .csv file for postprocessing by clicking the <a href="#Table_Save_Table_As">Save Table As</a> button.</p>
<p>The most important properties measured by SubframeSelector are <a href="#subframe_property_FWHM">FWHM</a>, <a href="#subframe_property_Eccentricity">Eccentricity</a>, <a href="#subframe_property_SNRWeight">SNRWeight</a>, <a href="#subframe_property_Median">Median</a>, <a href="#subframe_property_MeanDeviation">MeanDeviation</a> and <a href="#subframe_property_Noise">Noise</a>. The remaining properties <a href="#subframe_property_StarSupport">StarSupport</a>, <a href="#subframe_property_StarResidual">StarResidual</a>, <a href="#subframe_property_NoiseSupport">NoiseSupport</a>, <a href="#subframe_property_FWHMMeanDev">FWHMMeanDev</a>, <a href="#subframe_property_EccentricityMeanDev">EccentricityMeanDev</a> and <a href="#subframe_property_StarResidualMeanDev">StarResidualMeanDev</a> provide supporting information of secondary importance.</p>
<img src="images/TableBottomLeftAll.png" alt=""/>
<p>The last two rows of the table display the medians and mean deviations of the <a href="#Subframe_Properties">subframe properties</a> across all subframes. Mean deviation is the mean absolute deviation from the median of the property.</p>
<img style="margin-bottom:1em;" src="images/FWHM.png" alt=""/>
<img style="margin-bottom:1em;" src="images/Eccentricity.png" alt=""/>
<img src="images/SNRWeight.png" alt=""/>
<p>Select a plot ordinate from the <a href="#Plots_ordinate">Ordinate</a> list to view a plot of the selected <a href="#Subframe_Properties">subframe property</a>. The plot's abscissa represents subframes identified by their <a href="#subframe_property_Index">Index</a> property whose value equals the index of the subframe in the <a href="#Target_Subframes_section">Target Subframes</a> list. The plot's left hand ordinate axis is labeled in units selected either in the <a href="#System_Parameters_section">System Parameters</a> section or in the ordinate's natural units. The plot's right hand ordinate axis is labeled in normalized sigma units. Sigma values are normalized in mean absolute deviation units from the median of the property across all subframes.</p>
<p>The central horizontal dashed line corresponds to the median of the property across all subframes. The two horizontal dashed lines above and below the median line correspond to one mean absolute deviation unit greater than and less than the median, respectively.</p>
<p>The vertical dashed lines are visual aids to help associate subframes with their points. The points corresponding to adjacent subframes in index order whose observations occurred during the same night as specified by the <a href="#System_Parameters_Site_local_midnight">Site local midnight</a> parameter and the FITS keyword DATE-OBS are joined with darker lines. Lighter lines connect adjacent points of subframes whose observations occurred on different or unknown nights. In the example the observations were made across five nights.</p>
<p>A set of plots for all properties may be saved as a multiple image FITS file for archival by clicking the <a href="#Plots_Save_Plots_As">Save Plots As</a> button.</p>
</div>

<div class="pidoc_subsection" id="__Description_:_Subframe_Approval__">
   <h4 class="pidoc_subsectionTitle">1.2&emsp;<a id="subframe_approval"></a>Subframe Approval</h4>
<p>The SubframeSelector script includes a subframe approval facility, with the option of copying/moving all approved/rejected subframes to output directories for postprocessing. Choosing a subset of subframes that meet certain quaility requirements for integration is an example usage of this facility.</p>
<p>A subframe may be approved or rejected by any of the following four ways:</p>

<ul class="pidoc_list">
<li>By clicking the checkbox in the subframe's row in the table.</li>
<li>By selecting the subframe's row in the table and clicking the <a href="#Table_Toggle_Selected">Toggle Selected</a> button.</li>
<li>By clicking the subframe's point in a plot.</li>
<li>By specifying a <a href="#subframe_approval_expression">subframe approval expression</a> that defines a condition on subframe properities that must be satisfied for approval.</li>
</ul>

<p>An approved subframe is indicated by a checked checkbox in the table and a dot shaped point in the plot. A rejected subframe is indicated by an unchecked checkbox in the table and a cross shaped point in the plot. The row of a rejected subframe in the table is also drawn with a gray background.</p>
<p>A subframe approved or rejected by one of the first three ways listed above will also be <em>locked</em>. The <a href="#subframe_approval_expression">subframe approval expression</a> will not modify the approved/rejected state of locked subframes. This locking mechanism provides a convienient way to override <a href="#subframe_approval_expression">subframe approval expression</a> dispositions. A locked subframe is indicated with a bar icon to the right of its checkbox in the table and by a bar icon above its point in the plot. A locked subframe may be unlocked by any of these three ways:</p>

<ul class="pidoc_list">
<li>By selecting the subframe's row in the table and clicking the <a href="#Table_Unlock_Selected">Unlock Selected</a> button.</li>
<li>By shift-clicking the subframe's point in a plot.</li>
<li>By clicking the <a href="#Plots_Unlock_All">Unlock All</a> button in the <a href="#Plots_section">Plots</a> section. This action will unlock all locked subframes.</li>
</ul>

<p>Examples of subframe approval and rejection are shown below.</p>
<img src="images/SelectionFWHM.png" alt=""/>
<p>In the plot above note that the <a href="#subframe_property_FWHM">FWHM</a> of the first subframe is relatively high. This high <a href="#subframe_property_FWHM">FWHM</a> was due to focus drift during the observation as a result of a large change in ambient air temperature. The subframe can be rejected by clicking either its checkbox in the table or its point in the plot. The rejection is indicated by an unchecked checkbox and a cross shaped point. The subframe is also locked by this action. This lock is indicated by the bar icons.</p>
<img src="images/SelectionEccentricity.png" alt=""/>
<p>In the plot above note that all subframe <a href="#subframe_property_Eccentricity">Eccentricity</a> values are less than 0.42, the threshold of visible star distortion for most people. No additional subframes are rejected due to distortion. Note that the previously rejected subframe remains rejected.</p>
<img src="images/SelectionFWHMSNRWeight.png" alt=""/>
<p>In the plot above note that the <a href="#subframe_property_SNRWeight">SNRWeight</a> of the fourth subframe is relatively low. This low <a href="#subframe_property_SNRWeight">SNRWeight</a> was due to the presense of high clouds during the observation, resulting in a relatively low signal to noise ratio. The subframe can be rejected by clicking either its checkbox in the table or its point in the plot. Note that the previously rejected subframe remains rejected.</p>
<img src="images/ApprovalFWHMSNRWeight.png" alt=""/>
<p>In the plot above the subframe locks from the previous rejections were first released by clicking the <a href="#Plots_Unlock_All">Unlock Al</a>l button and then the expression <em>FWHM &lt; 4.7 &amp;&amp; SNRWeight &gt; 110</em> was entered as a <a href="#subframe_approval_expression">subframe approval expression</a>. This expression states that an approved subframe must have a <a href="#subframe_property_FWHM">FWHM</a> less than 4.7 and a <a href="#subframe_property_SNRWeight">SNRWeight</a> greater than 110. All subframes not satisfying this requirement are rejected. Note that all subframes remain unlocked.</p>
<img src="images/ApprovalFWHMSNRWeightOverride.png" alt=""/>
<p>In the plot above the subframe with index 24 was rejected by clicking its point in the plot. It is locked to prevent the <a href="#subframe_approval_expression">subframe approval expression</a> from overriding this disposition. Subframes 1 and 4 remain rejected by the <a href="#subframe_approval_expression">subframe approval expression</a>. In this example note that a subframe otherwise approved by the <a href="#subframe_approval_expression">subframe approval expression</a> was rejected by clicking its point. The converse is also possible, a subframe otherwise rejected by the <a href="#subframe_approval_expression">subframe approval expression</a> can be approved by clicking its point.</p>
<p>Subframe locks may be removed at any time as described above. Once a lock is removed, a subframe's disposition will be determined by the <a href="#subframe_approval_expression">subframe approval expression</a>.</p>
<p>Once subframe approval/rejection descisions have been completed, the approved/rejected subframes may be optionally copied/moved to output directories for postprocessing. See the section <a href="#Output_Subframes">Output Subframes</a> for details.</p>
</div>

<div class="pidoc_subsection" id="__Description_:_Subframe_Weighting__">
   <h4 class="pidoc_subsectionTitle">1.3&emsp;<a id="subframe_weighting"></a>Subframe Weighting</h4>
<p>The SubframeSelector script includes a subframe weighting facility, with the option of recording subframe weights in FITS headers for postprocessing. Assigning integration weights to subframes is an example usage of this facility. Another example is the determination of the &quot;best&quot; subframe for use as a registration reference.</p>
<p>Subframe weights are assigned by specifying a <a href="#subframe_weighting_expression">subframe weighting expression</a>. This expression is an arithmetic combination of a subframe properties whose value is interpreted as a subframe's weight.</p>
<p>Examples of subframe weighting are shown below.</p>
<img src="images/SNRWeightWeight.png" alt=""/>
<p>In the example above a subframe's weight equals the value of its <a href="#subframe_property_SNRWeight">SNRWeight</a> property. <a href="#subframe_property_SNRWeight">SNRWeight</a> is an unnormalized approximation of the current <em>NoiseEvaluation</em> weight used by the <a href="../../tools/ImageIntegration/ImageIntegration.html" title="../../tools/ImageIntegration/ImageIntegration.html">ImageIntegration</a> process. See the definition of the <a href="#subframe_property_SNRWeight">SNRWeight</a> property for more information.</p>
<p><a href="#subframe_property_SNRWeight">SNRWeight</a> weights are typically assigned to calibrated but unregistered subframes. These weights are carried through the <a href="../../tools/StarAlignment/StarAlignment.html" title="../../tools/StarAlignment/StarAlignment.html">StarAlignment</a> registration process in the FITS headers and used by <a href="../../tools/ImageIntegration/ImageIntegration.html" title="../../tools/ImageIntegration/ImageIntegration.html">ImageIntegration</a> for weighting purposes.</p>
<img src="images/FWHMSigmaFWHM.png" alt=""/>
<p>The goal of this example is to develop a subframe weighting that combines aspects of both <a href="#subframe_property_FWHM">FWHM</a> and <a href="#subframe_property_SNRWeight">SNRWeight</a>. In other words we want to find subframes that have both low <a href="#subframe_property_FWHM">FWHM</a> and high <a href="#subframe_property_SNRWeight">SNRWeight</a>. The best of these subframes might be used as a registration reference for the <a href="../../tools/StarAlignment/StarAlignment.html" title="../../tools/StarAlignment/StarAlignment.html">StarAlignment</a> process, for example.</p>
<p>The approach taken here to develop such a weight is to combine sigma normalized property values. Appending the suffix <em>Sigma</em> to a property name provides the property's value normalized in its sigma units. This value is scaled by the factor -3 in this example and used as the weighting expression. The absolute value 3 is choosen because it roughly equals the sigma value corresponding to the rejection threshold of 4.7 arcseconds. A negative value is choosen because larger <a href="#subframe_property_FWHM">FWHM</a> values correspond to smaller weights.</p>
<p>As a result, subframes whose <a href="#subframe_property_FWHM">FWHM</a> value equals the median are assigned weight 0, subframes with <a href="#subframe_property_FWHM">FWHM</a> smaller than the median are assigned positive weights, and subframes with <a href="#subframe_property_FWHM">FWHM</a> larger than the median are assigned negative weights. Furthermore, a subframe with a <a href="#subframe_property_FWHM">FWHM</a> three sigmas larger than the median (the rejection threshold) is assigned weight -1.</p>
<img src="images/SNRWeightSigmaSNRWeight.png" alt=""/>
<p>Next the same process is applied to <a href="#subframe_property_SNRWeight">SNRWeight</a>, noting that the rejection threshold of 110 corresponds to a sigma value of roughly -2. Here positive 2 is used as a normalization factor since unlike <a href="#subframe_property_FWHM">FWHM</a> larger <a href="#subframe_property_SNRWeight">SNRWeight</a> values correspond to better subframes. As a rule of thumb for this weighting scheme, a property's normalizing factor in the weighting expression equals the negative of its rejection threshold in sigma units.</p>
<img src="images/FWHMSNRWeightSigmaWeight.png" alt=""/>
<p>Finally, the two scaled, sigma normalized property values are combined by summation and used as a weighting expression. The results are viewed by choosing the plot ordinate <a href="#subframe_property_Weight">Weight</a>. Note as a sanity check that the two rejected subframes have lowest weight as expected. Note also that subframe 15 has the highest weight, it has the best weighted combination of <a href="#subframe_property_FWHM">FWHM</a> and <a href="#subframe_property_SNRWeight">SNRWeight</a> values given property statistics and the normalization factors. Of course, different normalization factors may be choosen to modify the relative significance of <a href="#subframe_property_FWHM">FWHM</a> and <a href="#subframe_property_SNRWeight">SNRWeight</a> in the combination.</p>
<p>Clearly a weighting scheme such as this is subjective in nature. The assigned weights depend on the underlying subframe property statistics as well as the choice of normalization factors. However, there may be no &quot;proper&quot; way to combine disparate measures like <a href="#subframe_property_FWHM">FWHM</a>, <a href="#subframe_property_SNRWeight">SNRWeight</a> and other subframe properties. Judgement is required given the intended use of the weights and the relative importance of subframe properties with respect to that use.</p>
<img src="images/FWHMSNRWeightSigmaTable.png" alt=""/>
<p>The table above is sorted by Weight in descending order. Note that subframe 22, the one with the smallest <a href="#subframe_property_FWHM">FWHM</a>, is located lower in the list due to its relatively smaller <a href="#subframe_property_SNRWeight">SNRWeight</a>. Similarily for subframe 14, the one with largest <a href="#subframe_property_SNRWeight">SNRWeight</a>. Subframe 15 has the best combination of <a href="#subframe_property_FWHM">FWHM</a> and <a href="#subframe_property_SNRWeight">SNRWeight</a> values and is rated highest by this particular weighting.</p>
</div>

<div class="pidoc_subsection" id="__Description_:_Output_Subframes__">
   <h4 class="pidoc_subsectionTitle">1.4&emsp;<a id="Output_Subframes"></a>Output Subframes</h4>
<img src="images/OutputButtons.png" alt=""/>
<p>Once subframes have been approved or rejected, and optionally subframe weights applied, the approved and/or rejected subframes may be copied and/or moved to output directories by clicking the <a href="#Output_Subframes_button">Output Subframes</a> button. Output directories for approved and rejected subframes may be specified in the <a href="#Output_Approved_directory">Approved directory</a> and <a href="#Output_Rejected_directory">Rejected directory</a> fields, respectively. If a directory field is left blank, the associated subframes will be written to the same directories as their corresponding target files. The action fields specify the file operation performed for approved and rejected subframes, either copy, move or none. The postfix fields specify postfixes that will be appended to the file name of each copied or moved subframe. To record subframe weights in the FITS headers of the copies specify a FITS keyword in the <a href="#Output_Weight_keyword">Weight keyword</a> field. Note that weights may be recorded in copied subframes but not in moved subframes.</p>
</div>

<div class="pidoc_subsection" id="__Description_:_Output_Subframe_Star_Maps__">
   <h4 class="pidoc_subsectionTitle">1.5&emsp;Output Subframe Star Maps</h4>
<img src="images/OutputMaps.png" alt=""/>
<p>Star maps for all subframes, both approved and rejected, may be output by clicking the <a href="#Output_Maps_button">Output Maps</a> button. A star map for a subframe consists of two files, a multi image FITS file and a <em>comma separated value</em> .csv file.</p>
<img style="margin-bottom:1em;" src="images/SubframeMap.png" alt=""/>
<img style="margin-bottom:1em;" src="images/SubframeFWHM.png" alt=""/>
<img src="images/SubframeEccentricity.png" alt=""/>
<p>The first image in the star map multi image FITS file is a map of the positions of the fitted stars in the subframe along with their sigma normalized and integer rounded fitting residuals. The sigma normalization is computed relative to the values of the subframe's <a href="#subframe_property_StarResidual">StarResidual</a> and <a href="#subframe_property_StarResidualMeanDev">StarResidualMeanDev</a> properites.</p>
<p>The second image shows the spatial variation of star profile <a href="#subframe_property_FWHM">FWHM</a> across the subframe.</p>
<p>The third shows the spatial variation of star profile <a href="#subframe_property_Eccentricity">Eccentricity</a> across the subframe.</p>
<p>The <em>comma separated value</em> value .csv file contains PSF model specific fitting parameters for each fitted star. See the documentation of the <a href="../../tools/DynamicPSF/DynamicPSF.html" title="../../tools/DynamicPSF/DynamicPSF.html">DynamicPSF</a> process for more information.</p>
</div>

<div class="pidoc_subsection" id="__Description_:_Subframe_Properties__">
   <h4 class="pidoc_subsectionTitle">1.6&emsp;<a id="Subframe_Properties"></a>Subframe Properties</h4>
<p>SubframeSelector provides values of the following properties for each measured subframe.</p>

<dl class="pidoc_list">
<dt>
<p><a id="subframe_property_Index"></a> Index</p>
</dt>
<dd>
<img src="images/Index.png" alt=""/>
<p>The <em>index</em> number of the subframe in the <a href="#Target_subframes_list">Target subframes list</a>.</p>
</dd>
<dt>
<p><a id="subframe_property_Weight"></a> Weight</p>
</dt>
<dd>
<img src="images/Weight.png" alt=""/>
<p>The <em>weight</em> of the subframe as determined by the <a href="#subframe_weighting_expression">subframe weighting expression</a>.</p>
</dd>
<dt>
<p><a id="subframe_property_FWHM"></a> FWHM</p>
</dt>
<dd>
<img src="images/FWHM.png" alt=""/>
<p>The median star profile <em>full width at half maximum</em> (FWHM) estimate for the subframe in arcseconds or pixels. The FWHM is a well-known and standardized measurement of the size of a star as seen on the subframe. It is the width normalized in arcseconds or pixels of a functional fit to a star image, measured horizontally at half its maximum value.</p>
</dd>
<dt>
<p><a id="subframe_property_Eccentricity"></a> Eccentricity</p>
</dt>
<dd>
<img src="images/Eccentricity.png" alt=""/>
<p>The median star profile <em>eccentricity</em> estimate for the subframe. Eccentricity is a measure of star profile distortion. Given an elliptical star profile with major axis diameter <em>a</em> and minor axis diameter <em>b</em> where <em>a</em> is greater than or equal to <em>b</em>, the star profile <em>eccentricity</em> equals (1 - <em>b</em><sup>2</sup> / <em>a</em><sup>2</sup>)<sup>0.5</sup>, the star profile <em>aspect ratio</em> equals <em>b</em> / <em>a</em> and the star profile <em>flatness</em> equals <em>a</em> / <em>b</em> - 1. A distortion with an eccentricity less than about 0.42 is not perceptible to most people. The table below shows the relationship between these measures.</p>

<table class="pidoc_table">
<caption><a id="__table_1__"></a>
<span class="pidoc_table_title">Table 1</span></caption>
<tr>
<th><p>Eccentricity</p>
</th>
<th><p>Aspect Ratio</p>
</th>
<th><p>Flatness</p>
</th>
</tr>
<tr>
<td><p>0.20</p>
</td>
<td><p>0.98</p>
</td>
<td><p>0.02</p>
</td>
</tr>
<tr>
<td><p>0.22</p>
</td>
<td><p>0.98</p>
</td>
<td><p>0.03</p>
</td>
</tr>
<tr>
<td><p>0.24</p>
</td>
<td><p>0.97</p>
</td>
<td><p>0.03</p>
</td>
</tr>
<tr>
<td><p>0.26</p>
</td>
<td><p>0.97</p>
</td>
<td><p>0.04</p>
</td>
</tr>
<tr>
<td><p>0.28</p>
</td>
<td><p>0.96</p>
</td>
<td><p>0.04</p>
</td>
</tr>
<tr>
<td><p>0.30</p>
</td>
<td><p>0.95</p>
</td>
<td><p>0.05</p>
</td>
</tr>
<tr>
<td><p>0.32</p>
</td>
<td><p>0.95</p>
</td>
<td><p>0.06</p>
</td>
</tr>
<tr>
<td><p>0.34</p>
</td>
<td><p>0.94</p>
</td>
<td><p>0.06</p>
</td>
</tr>
<tr>
<td><p>0.36</p>
</td>
<td><p>0.93</p>
</td>
<td><p>0.07</p>
</td>
</tr>
<tr>
<td><p>0.38</p>
</td>
<td><p>0.92</p>
</td>
<td><p>0.08</p>
</td>
</tr>
<tr>
<td><p>0.40</p>
</td>
<td><p>0.92</p>
</td>
<td><p>0.09</p>
</td>
</tr>
<tr>
<td><p>0.42</p>
</td>
<td><p>0.91</p>
</td>
<td><p>0.10</p>
</td>
</tr>
<tr>
<td><p>0.44</p>
</td>
<td><p>0.90</p>
</td>
<td><p>0.11</p>
</td>
</tr>
<tr>
<td><p>0.46</p>
</td>
<td><p>0.89</p>
</td>
<td><p>0.13</p>
</td>
</tr>
<tr>
<td><p>0.48</p>
</td>
<td><p>0.88</p>
</td>
<td><p>0.14</p>
</td>
</tr>
<tr>
<td><p>0.50</p>
</td>
<td><p>0.87</p>
</td>
<td><p>0.15</p>
</td>
</tr>
<tr>
<td><p>0.52</p>
</td>
<td><p>0.85</p>
</td>
<td><p>0.17</p>
</td>
</tr>
<tr>
<td><p>0.54</p>
</td>
<td><p>0.84</p>
</td>
<td><p>0.19</p>
</td>
</tr>
<tr>
<td><p>0.56</p>
</td>
<td><p>0.83</p>
</td>
<td><p>0.21</p>
</td>
</tr>
<tr>
<td><p>0.58</p>
</td>
<td><p>0.81</p>
</td>
<td><p>0.23</p>
</td>
</tr>
<tr>
<td><p>0.60</p>
</td>
<td><p>0.80</p>
</td>
<td><p>0.25</p>
</td>
</tr>
</table>

</dd>
<dt>
<p><a id="subframe_property_SNRWeight"></a> SNRWeight</p>
</dt>
<dd>
<img src="images/SNRWeight.png" alt=""/>
<p>The <em>signal to noise ratio weight</em> estimate for the subframe. SNRWeight equals <a href="#subframe_property_MeanDeviation">MeanDeviation</a><sup>2</sup> / <a href="#subframe_property_Noise">Noise</a><sup>2</sup>. SNRWeight is unnormalized approximation to the current <em>NoiseEvaluation</em> weight used by the <a href="../../tools/ImageIntegration/ImageIntegration.html" title="../../tools/ImageIntegration/ImageIntegration.html">ImageIntegration</a> process when configured to use the average absolute deviation from the median as a scale estimator. In a subframe integration, the ratio between a subframe's SNRWeight and the reference subframe's SNRWeight approximately equals the <em>NoiseEvaluation</em> weight of the subframe.</p>
<p>The significance of the unnormalized SNRWeight and the normalized <em>NoiseEvaluation</em> weight is that a weighted subframe integration using these weights is an approximate maximum likelyhood estimator for pixel values that correspond to background limited targets, without requiring additional information such as exposure times or sensor parameters. See the <a href="../../tools/ImageIntegration/ImageIntegration.html" title="../../tools/ImageIntegration/ImageIntegration.html">ImageIntegration</a> documentation for more information.</p>
<p>Note that SNRWeight and <em>NoiseEvaluation</em> weight are relative and not absolute measures of signal to noise ratio. Their formulation assumes that the subframes represent observations of the same target with the same filter and that the subframes have similar background gradients.</p>
<p>Frames with higher numbers are better, eg., less camera noise, less light pollution and sky background, more transparent skies and less atmospheric extinction, more exposure time, etc.</p>
<p>Note SNRWeight is not foolproof. You still should blink your frames. Strongly differing gradients, bright star halos from high thin clouds, etc, can result in bogus SNRWeight values.</p>
</dd>
<dt>
<p><a id="subframe_property_Median"></a> Median</p>
</dt>
<dd>
<img src="images/Median.png" alt=""/>
<p>The <em>median</em> of the subframe in electrons or Data Numbers.</p>
</dd>
<dt>
<p><a id="subframe_property_MeanDeviation"></a> MeanDeviation</p>
</dt>
<dd>
<img src="images/MeanDeviation.png" alt=""/>
<p>The <em>mean absolute deviation from the median</em> of the subframe in electrons or Data Numbers.</p>
</dd>
<dt>
<p><a id="subframe_property_Noise"></a> Noise</p>
</dt>
<dd>
<img src="images/Noise.png" alt=""/>
<p>An estimate of the <em>standard deviation of Gaussian noise</em> for the subframe in electrons or Data Numbers. Noise is currently determined by a wavelet-based multiscale algorithm<sup><a href="#__reference_1__" class="pidoc_referenceTooltip" onmouseover="pidoc_showReferenceToolTip( this );" onmouseout="pidoc_hideReferenceToolTip();" data-tooltip="[Reference 1]<br/>
Jean-Luc Starck and Fionn Murtagh, <em>Automatic Noise Estimation from the Multiresolution Support</em>, Publications of the Royal Astronomical Society of the Pacific, vol. 110, February 1998, pp. 193-199">[1]</a></sup>.</p>
</dd>
<dt>
<p><a id="subframe_property_StarSupport"></a> StarSupport</p>
</dt>
<dd>
<img src="images/StarSupport.png" alt=""/>
<p>The number of stars detected and fitted in the subframe and used to estimate <a href="#subframe_property_FWHM">FWHM</a>, <a href="#subframe_property_Eccentricity">Eccentricity</a>, <a href="#subframe_property_FWHMMeanDev">FWHMMeanDev</a> and <a href="#subframe_property_EccentricityMeanDev">EccentricityMeanDev</a>.</p>
<p>StarSupport may sometimes be used as a measure of subframe quality, as worse observing conditions such as clouds, less exposure time, etc, will result in fewer detectable stars. Note however that for undersampled subframes, stars are tiny and the dimmest usually will be rejected as hot pixels. Better focus, better seeing, and better tracking will result in even smaller stars, higher hot pixel rejection, and smaller StarSupport values. So a smaller StarSupport may indicate a better subframe.</p>
</dd>
<dt>
<p><a id="subframe_property_StarResidual"></a> StarResidual</p>
</dt>
<dd>
<img src="images/StarResidual.png" alt=""/>
<p>The median <em>residual</em> of the star fitting process for the subframe. Residuals are currently measured as the mean absolute deviation between the fitted <a href="#Star_Detection_and_Fitting_Point_spread_function">PSF</a> model and the star image data in normalized units.</p>
</dd>
<dt>
<p><a id="subframe_property_NoiseSupport"></a> NoiseSupport</p>
</dt>
<dd>
<img src="images/NoiseSupport.png" alt=""/>
<p>The fractional number of pixels in the subframe deemed free of image structure and used to estimate <a href="#subframe_property_Noise">Noise</a>.</p>
</dd>
<dt>
<p><a id="subframe_property_FWHMMeanDev"></a> FWHMMeanDev</p>
</dt>
<dd>
<img src="images/FWHMMeanDev.png" alt=""/>
<p>The mean absolute deviation from the median star profile <em>full width at half maximum</em> (FWHM) estimate for the subframe in arcseconds or pixels.</p>
</dd>
<dt>
<p><a id="subframe_property_EccentricityMeanDev"></a> EccentricityMeanDev</p>
</dt>
<dd>
<img src="images/EccentricityMeanDev.png" alt=""/>
<p>The mean absolute deviation from the median star profile <em>eccentricity</em> estimate for the subframe.</p>
</dd>
<dt>
<p><a id="subframe_property_StarResidualMeanDev"></a> StarResidualMeanDev</p>
</dt>
<dd>
<img src="images/StarResidualMeanDev.png" alt=""/>
<p>The mean absolute deviation from the median <em>residual</em> of the star fitting process for the subframe.</p>
</dd>
<dt>
<p>Date</p>
</dt>
<dd>
<img src="images/Date.png" alt=""/>
<p>The observation date and Coordinated Universal Time (UTC) of the subframe, as provided by the value of the FITS keyword DATE-OBS (if available).</p>
</dd>
</dl>

</div>

<div class="pidoc_subsection" id="__Description_:_Subframe_Expressions__">
   <h4 class="pidoc_subsectionTitle">1.7&emsp;<a id="subframe_expressions"></a>Subframe Expressions</h4>
<p>SubframeSelector provides a subframe expression parser and interpreter as an aid for subframe approval and weighting. A simple <em>metalanguage</em> will be used to describe subframe expression syntax rules and syntactical elements. Italicized san-serif text is used by the metalanguage to denote <em>metasymbols</em>, which represent expression elements in formal terms. The following <em>metanotations</em> are defined on <em>metaelements</em>.</p>
<p>The metanotation [ <em>a</em> ] denotes either zero or one repetition of the metaelement <em>a</em>.</p>
<p>The metanotation [ <em>a</em> ]... denotes zero, one or more repetitions of the metaelement <em>a</em>.</p>
<p>The metanotation [ <em>a</em> | <em>b</em> | ... | <em>z</em> ] denotes exactly one of the metaelements <em>a</em>, <em>b</em>, ..., or <em>z</em>.</p>
</div>

<div class="pidoc_subsection" id="__Description_:_Subframe_Approval_Expression__">
   <h4 class="pidoc_subsectionTitle">1.8&emsp;<a id="subframe_approval_expression"></a>Subframe Approval Expression</h4>
<p>Subframe approval expressions specify constraints on subframe properties. Subframes with properties that satisfy a subframe approval expression are considered <em>approved</em> by that expression. Subframes that do not satisfy a subframe selector expression are considered <em>rejected</em> by that expression. All subframes satisfy a blank (empty) subframe approval expression.</p>
<p>Subframe approval expressions consist of boolean combinations of constraints on weighting expressions. Weighting expressions consist of arithmetic combinations of subframe properties.</p>
<p>The following metalanguage defines subframe approval expression syntax rules and syntactical elements.</p>
<p>The binary operators &amp;&amp; and || denote <em>logical-and</em> and <em>logical-or</em>, respectively. The unary operator ! denotes <em>logical-not</em>. The binary operators &lt;, &gt;, &lt;=, &gt;=, == and != denote <em>less-than</em>, <em>greater-than</em>, <em>less-than-or-equal</em>, <em>greater-than-or-equal</em>, <em>equal</em> and <em>not-equal</em>, respectively. The binary operators +, -, *, / and ^ denote <em>addition</em>, <em>subtraction</em>, <em>multiplication</em>, <em>division</em> and <em>exponentiation</em>, respectively. The unary operator - denotes <em>negation</em>.</p>
<p>Property values are defined in units either specified in the <a href="#Subframe_Properties">Subframe Properties</a> section or in natural units. Properties whose name ends in <em>Sigma</em> provide property values normalized in mean absolute deviation units from the median of the property.</p>
<p><em>approval</em> = [ <em>constraint</em> [ [ &amp;&amp; | || ] <em>constraint</em> ]... ]</p>
<p><em>constraint</em> = [ <em>weighting</em> [ &lt; | &gt; | &lt;= | &gt;= | == | != ] <em>weighting</em> | true | false | [ ! ] (<em>approval</em>) ]</p>
<p><em>weighting</em> = <em>term</em> [ [ + | - | * | / | ^ ] <em>term</em> ]...</p>
<p><em>term</em> = [ - ] [ <em>number</em> | <em>property</em> | (<em>weighting</em>) ]</p>
<p><em>property</em> = [ <a href="#subframe_property_Index">Index</a> | <a href="#subframe_property_Weight">Weight</a> | WeightSigma | <a href="#subframe_property_FWHM">FWHM</a> | FWHMSigma | <a href="#subframe_property_Eccentricity">Eccentricity</a> | EccentricitySigma | <a href="#subframe_property_SNRWeight">SNRWeight</a> | SNRWeightSigma | <a href="#subframe_property_Median">Median</a> | MedianSigma | <a href="#subframe_property_MeanDeviation">MeanDeviation</a> | MeanDeviationSigma | <a href="#subframe_property_Noise">Noise</a> | NoiseSigma | <a href="#subframe_property_StarSupport">StarSupport</a> | StarSupportSigma | <a href="#subframe_property_StarResidual">StarResidual</a> | StarResidualSigma | <a href="#subframe_property_NoiseSupport">NoiseSupport</a> | NoiseSupportSigma | <a href="#subframe_property_FWHMMeanDev">FWHMMeanDev</a> | FWHMMeanDevSigma | <a href="#subframe_property_EccentricityMeanDev">EccentricityMeanDev</a> | EccentricityMeanDevSigma | <a href="#subframe_property_StarResidualMeanDev">StarResidualMeanDev</a> | StarResidualMeanDevSigma ]</p>
</div>

<div class="pidoc_subsection" id="__Description_:_Subframe_Weighting_Expression__">
   <h4 class="pidoc_subsectionTitle">1.9&emsp;<a id="subframe_weighting_expression"></a>Subframe Weighting Expression</h4>
<p>The value of a subframe's <a href="#subframe_property_Weight">Weight</a> property is specified by a subframe weighting expression. A blank (empty) subframe weighting expression assigns a zero weight.</p>
<p>Weighting expressions consist of arithmetic combinations of subframe properties.</p>
<p>The following metalanguage defines subframe weighting expression syntax rules and syntactical elements.</p>
<p>The binary operators +, -, *, / and ^ denote <em>addition</em>, <em>subtraction</em>, <em>multiplication</em>, <em>division</em> and <em>exponentiation</em>, respectively. The unary operator - denotes <em>negation</em>.</p>
<p>Property values are defined in units either specified in the <a href="#Subframe_Properties">Subframe Properties</a> section or in natural units. Properties whose name ends in <em>Sigma</em> provide property values normalized in mean absolute deviation units from the median of the property.</p>
<p><em>weighting</em> = [ <em>term</em> [ [ + | - | * | / | ^ ] <em>term</em> ]... ]</p>
<p><em>term</em> = [ - ] [ <em>number</em> | <em>property</em> | (<em>weighting</em>) ]</p>
<p><em>property</em> = [ <a href="#subframe_property_Index">Index</a> | <a href="#subframe_property_FWHM">FWHM</a> | FWHMSigma | <a href="#subframe_property_Eccentricity">Eccentricity</a> | EccentricitySigma | <a href="#subframe_property_SNRWeight">SNRWeight</a> | SNRWeightSigma | <a href="#subframe_property_Median">Median</a> | MedianSigma | <a href="#subframe_property_MeanDeviation">MeanDeviation</a> | MeanDeviationSigma | <a href="#subframe_property_Noise">Noise</a> | NoiseSigma | <a href="#subframe_property_StarSupport">StarSupport</a> | StarSupportSigma | <a href="#subframe_property_StarResidual">StarResidual</a> | StarResidualSigma | <a href="#subframe_property_NoiseSupport">NoiseSupport</a> | NoiseSupportSigma | <a href="#subframe_property_FWHMMeanDev">FWHMMeanDev</a> | FWHMMeanDevSigma | <a href="#subframe_property_EccentricityMeanDev">EccentricityMeanDev</a> | EccentricityMeanDevSigma | <a href="#subframe_property_StarResidualMeanDev">StarResidualMeanDev</a> | StarResidualMeanDevSigma ]</p>
</div>

   </div>
</div>

<div class="pidoc_section" id="__Usage__">
   <h3 class="pidoc_sectionTitle">2&emsp;Usage</h3>
   <p class="pidoc_sectionToggleButton" onclick="pidoc_toggleSection( 'Usage', this );">[hide]</p>
   <div id="Usage">
<div class="pidoc_subsection" id="__Usage_:_Target_Subframes__">
   <h4 class="pidoc_subsectionTitle">2.1&emsp;<a id="Target_Subframes_section"></a>Target Subframes</h4>
<img src="images/TargetSubframes.png" alt=""/>
<p>Use these controls to define and manage a list of subframes to be processed by SubframeSelector.</p>

<dl class="pidoc_list">
<dt>
<p><a id="Target_subframes_list"></a> Target subframes list</p>
</dt>
<dd>
<p>This control is a list with all the subframes currently selected for measurement. The list will show full file paths or just file names, depending on the state of the <a href="#Target_Subframes_Full_paths">Full paths</a> checkbox. On this list you can:</p>

<ul class="pidoc_list">
<li>Click on a item's checkbox to toggle its state. Unchecked target subframes will be ignored during the measurement and output processes of SubframeSelector.</li>
<li>View full file paths as tool tip messages whenever the list shows just file names.</li>
</ul>

</dd>
<dt>
<p>Add Files...</p>
</dt>
<dd>
<p>Click this button to open a file dialog where you can select existing subframe files, which will be appended to the current list of target subframes.</p>
</dd>
<dt>
<p>Toggle Selected</p>
</dt>
<dd>
<p>Click to toggle the checked/unchecked state of the current selection in the list of target subframes. Unchecked target subframes will be ignored during the measurement and output processes of SubframeSelector.</p>
</dd>
<dt>
<p>Remove Selected</p>
</dt>
<dd>
<p>Click to remove current selection from the list of target subframes.</p>
</dd>
<dt>
<p>Clear</p>
</dt>
<dd>
<p>Click to clear the list of target subframes.</p>
</dd>
<dt>
<p><a id="Target_Subframes_Full_paths"></a> Full paths</p>
</dt>
<dd>
<p>When this option is selected, the list of target subframes will show the full absolute file paths of the target subframes. When this option is not selected, only file names will be shown and full file paths are shown as tool tip messages.</p>
</dd>
<dt>
<p>Use file cache</p>
</dt>
<dd>
<p>Enable to use a file cache. This cache usually improves performance when the same subframes are measured more than once.</p>
<p>Note that the <a href="#Output_Maps_button">output star maps</a> process does not use the file cache. Additional subframe measurements may be required to complete this process.</p>
</dd>
</dl>

</div>

<div class="pidoc_subsection" id="__Usage_:_System_Parameters__">
   <h4 class="pidoc_subsectionTitle">2.2&emsp;<a id="System_Parameters_section"></a>System Parameters</h4>
<img src="images/SystemParameters.png" alt=""/>
<p>This section provides access to parameters that specify subframe, camera, observation site, presentation units and pedestal information.</p>

<dl class="pidoc_list">
<dt>
<p>Subframe scale</p>
</dt>
<dd>
<p>This parameter specifies target subframe scale in arcseconds per pixel. All target subframes must share the same subframe scale value.</p>
<p>SubframeSelector will represent <a href="#subframe_property_FWHM">FWHM</a> and <a href="#subframe_property_FWHMMeanDev">FWHMMeanDev</a> properties in either arcseconds or pixels depending on the value of the <a href="#System_Parameters_Scale_unit">Scale unit</a> parameter.</p>
</dd>
<dt>
<p><a id="System_Parameters_Camera_gain"></a> Camera gain</p>
</dt>
<dd>
<p>This parameter specifies camera gain in electrons per Data Number. All target subframes must share the same camera gain value.</p>
<p>By using the values of this parameter and <a href="#System_Parameters_Camera_resolution">Camera resolution</a>, SubframeSelector will represent all <a href="#subframe_property_Median">Median</a>, <a href="#subframe_property_MeanDeviation">MeanDeviation</a> and <a href="#subframe_property_Noise">Noise</a> property values in either electrons or Data Numbers depending on the value of the <a href="#System_Parameters_Data_unit">Data unit</a> parameter.</p>
</dd>
<dt>
<p><a id="System_Parameters_Camera_resolution"></a> Camera resolution</p>
</dt>
<dd>
<p>This parameter specifies camera resolution in bits per pixel. All target subframes must share the same camera resolution value.</p>
<p>By using the values of this parameter and <a href="#System_Parameters_Camera_gain">Camera gain</a>, SubframeSelector will represent all <a href="#subframe_property_Median">Median</a>, <a href="#subframe_property_MeanDeviation">MeanDeviation</a> and <a href="#subframe_property_Noise">Noise</a> property values in either electrons or Data Numbers depending on the value of the <a href="#System_Parameters_Data_unit">Data unit</a> parameter.</p>
</dd>
<dt>
<p><a id="System_Parameters_Site_local_midnight"></a> Site local midnight</p>
</dt>
<dd>
<p>This parameters specifies the Coordinated Universal Time (UTC) of local midnight at the site of target subframe observation, rounded to the nearest hour from 0 to 23. If this time is unknown or varies by more than six hours for the target subframes, set this parameter to 24.</p>
<p>SubframeSelector uses this parameter and the value of the FITS keyword DATE-OBS (if available) to identify adjacent sequences of subframes in the <a href="#Target_subframes_list">Target subframes list</a> whose observations occurred during the same night.</p>
</dd>
<dt>
<p><a id="System_Parameters_Scale_unit"></a> Scale unit</p>
</dt>
<dd>
<p>This parameter specifies the camera pixel scale unit used for measurement presentation. Options are arcseconds and pixels.</p>
</dd>
<dt>
<p><a id="System_Parameters_Data_unit"></a> Data unit</p>
</dt>
<dd>
<p>This parameter specifies the camera pixel data unit used for measurement presentation. Options are electrons and Data Numbers.</p>
</dd>
</dl>

</div>

<div class="pidoc_subsection" id="__Usage_:_Star_Detection_and_Fitting__">
   <h4 class="pidoc_subsectionTitle">2.3&emsp;<a id="Star_Detection_and_Fitting_section"></a>Star Detection and Fitting</h4>
<img src="images/StarDetectionandFitting.png" alt=""/>
<p>This section provides access to parameters that control the star detection and fitting processes of SubframeSelector.</p>
<p>The star detection parameters should be tuned to detect between several hundred and several thousand stars per subframe. In most cases fewer than several hundred detected stars may risk compromising the accuracy of the measured statistics and more than several thousand detected stars wastes computation time and memory without any additional improvement in accuracy. The number of stars detected and fitted per subframe is provided by the <a href="#subframe_property_StarSupport">StarSupport</a> property once the measurement process has completed. A map of detected and fitted stars and their residuals in each subframe may also be generated by clicking the <a href="#Output_Maps_button">Output Maps</a> button.</p>

<dl class="pidoc_list">
<dt>
<p>Star detection layers</p>
</dt>
<dd>
<p>This parameter specifies the number of wavelet layers used for star detection.</p>

<ul class="pidoc_list">
<li>With more wavelet layers larger stars and perhaps also some nonstellar objects will be detected.</li>
<li>Fewer wavelet layers favors detection of smaller, and hence more, stars.</li>
</ul>

</dd>
<dt>
<p>Noise reduction layers</p>
</dt>
<dd>
<p>This parameter specifies the number of wavelet layers used for noise reduction. Noise reduction prevents detection of bright noise structures as false stars, including hot pixels and cosmic rays.</p>
<p>This parameter can also be used to control the sizes of the smallest detected stars (increase to exclude more stars).</p>
</dd>
<dt>
<p>Hot pixel filter radius</p>
</dt>
<dd>
<p>This parameter specifies the radius in pixels of median filter applied before star detection to remove hot pixels.</p>
<p>To disable hot pixel removal, set this parameter to zero.</p>
</dd>
<dt>
<p>Log(detection sensitivity)</p>
</dt>
<dd>
<p>This parameter specifies the logarithm of the star detection sensitivity. The sensitivity of the star detection algorithm is measured with respect to the <em>local background</em> of each detected star. Given a star with estimated brightness <em>s</em> and local background <em>b</em>, sensitivity is the minimum value of (<em>s</em> - <em>b</em>) / <em>b</em> necessary to trigger star detection.</p>
<p>Decrease this parameter to favor detection of fainter stars or stars on brighter backgrounds. Increase it to restrict detection to brighter stars or stars on dimmer backgrounds.</p>
</dd>
<dt>
<p>Star peak response</p>
</dt>
<dd>
<p>This parameter specifies star peak response. If you decrease this parameter, stars will need to have more prominent peaks to be detected by the star detection algorithm. By increasing this parameter, the star detection algorithm will be more permissive with relatively flat stars.</p>
</dd>
<dt>
<p>Maximum star distortion</p>
</dt>
<dd>
<p>This parameter specifies maximum star distortion. Star distortion is the fractional area of the star's bounding box covered by the star. The distortion of a perfectly circular star is about 0.75 (actually, π/4). Decrease this parameter to detect stars with larger elongation.</p>
</dd>
<dt>
<p>Upper limit</p>
</dt>
<dd>
<p>Stars with peak values larger than this value won't be measured. This feature may be used to avoid the measurement of saturated and bloomed stars. To disable this feature, set this parameter to one. To disable star detection entirely, set this parameter to zero.</p>
</dd>
<dt>
<p>Subframe region</p>
</dt>
<dd>
<p>This parameter defines a rectangular region of each target subframe that will be measured. The successive values specify the left, top, width and height of the region. To measure the entire area of each subframe set all four values to zero.</p>
<p>Both the width and height of the region must be at least 256 pixels. Regions smaller than this will be ignored and the entire area of each subframe will be measured.</p>
</dd>
<dt>
<p>Pedestal</p>
</dt>
<dd>
<p>This parameters specifies a (usually small) quantity that is subtracted from each target subframe prior to the measurement process.</p>
</dd>
<dt>
<p><a id="Star_Detection_and_Fitting_Point_spread_function"></a> Point spread function</p>
</dt>
<dd>
<p>This parameter specifies the <em>point spread function</em> (PSF) used to fit star images. SubframeSelector can fit circular or elliptical <em>Gaussian</em> functions, <em>Moffat</em> <sup><a href="#__reference_2__" class="pidoc_referenceTooltip" onmouseover="pidoc_showReferenceToolTip( this );" onmouseout="pidoc_hideReferenceToolTip();" data-tooltip="[Reference 2]<br/>
Moffat, A. F. J., <em>A Theoretical Investigation of Focal Stellar Images in the Photographic Emulsion and Application to Photographic Photometry</em>, Astronomy and Astrophysics, Vol. 3, p. 455 (1969)">[2]</a></sup> functions with a selected &beta; parameter, and <em>Lorentzian</em> functions. These functions have been selected because their shapes make them particularly suitable to model stellar objects represented on most deep-sky images. The PSF functions are defined in the <a href="../../tools/DynamicPSF/DynamicPSF.html" title="../../tools/DynamicPSF/DynamicPSF.html">DynamicPSF</a> process documentation.</p>
<p>Note that FWHM and eccentricity measurements for Gaussian, Moffat and Lorentzian functions are in general not compatible and should not be mutually compared. Also avoid comparing FWHM and eccentricity measurements with results obtained in other applications. Each application implements different methods in different ways and the results are in general not compatible.</p>
</dd>
<dt>
<p>Circular point spread function</p>
</dt>
<dd>
<p>Enable this option to fit circular point spread functions. Disable it to fit elliptical functions.</p>
<p>Circular functions can provide more robust and useful results in cases of strong undersampling or high noise levels.</p>
</dd>
</dl>

</div>

<div class="pidoc_subsection" id="__Usage_:_Expressions__">
   <h4 class="pidoc_subsectionTitle">2.4&emsp;Expressions</h4>
<img src="images/Expressions.png" alt=""/>

<dl class="pidoc_list">
<dt>
<p>Approval</p>
</dt>
<dd>
<p>This parameter specifies the <a href="#subframe_approval_expression">subframe approval expression</a>, a constraint on subframe properties used to approve and reject subframes.</p>
<img src="images/ApprovalError.png" alt=""/>
<p>A cross icon to the left of the <a href="#subframe_approval_expression">subframe approval expression</a> indicates that the expression is invalid and that all unlocked subframes will be approved. In this example the insertion of the text <em>xxx</em> causes the expression to be invalid.</p>
</dd>
<dt>
<p>Approval Edit</p>
</dt>
<dd>
<p>Click this button to edit the <a href="#subframe_approval_expression">subframe approval expression</a>. The following dialog will be presented.</p>
<img src="images/EditApproval.png" alt=""/>

<dl class="pidoc_list">
<dt>
<p>Parse</p>
</dt>
<dd>
<p>Click this button to parse the subframe selector expression. If the expression is invalid, an alert will be displayed with diagnostic information.</p>
</dd>
<dt>
<p>OK</p>
</dt>
<dd>
<p>Click this button to accept the edit.</p>
</dd>
<dt>
<p>Cancel</p>
</dt>
<dd>
<p>Click this button to cancel the edit.</p>
</dd>
</dl>

</dd>
<dt>
<p>Weighting</p>
</dt>
<dd>
<p>This parameter specifies the <a href="#subframe_weighting_expression">subframe weighting expression</a>, an arithmetic combination of subframe properties used to assign subframe weights.</p>
<img src="images/WeightingError.png" alt=""/>
<p>A cross icon to the left of the <a href="#subframe_weighting_expression">subframe weighting expression</a> indicates that the expression is invalid and that zero will be used as a substitute weight. In this example the insertion of the text <em>xxx</em> causes the expression to be invalid.</p>
</dd>
<dt>
<p>Weighting Edit</p>
</dt>
<dd>
<p>Click this button to edit the <a href="#subframe_weighting_expression">subframe weighting expression</a>. The following dialog will be presented.</p>
<img src="images/EditWeighting.png" alt=""/>

<dl class="pidoc_list">
<dt>
<p>Parse</p>
</dt>
<dd>
<p>Click this button to parse the subframe weighting expression. If the expression is invalid, an alert will be displayed with diagnostic information.</p>
</dd>
<dt>
<p>OK</p>
</dt>
<dd>
<p>Click this button to accept the edit.</p>
</dd>
<dt>
<p>Cancel</p>
</dt>
<dd>
<p>Click this button to cancel the edit.</p>
</dd>
</dl>

</dd>
</dl>

</div>

<div class="pidoc_subsection" id="__Usage_:_Table__">
   <h4 class="pidoc_subsectionTitle">2.5&emsp;Table</h4>
<img style="margin-bottom:1em;" src="images/TableTopLeftAll.png" alt=""/>
<img src="images/TableBottomLeftAll.png" alt=""/>

<dl class="pidoc_list">
<dt>
<p>Subframes table</p>
</dt>
<dd>
<p>The table contains one row per subframe with the subframe's <a href="#subframe_property_Index">Index</a> and file name listed in the first column and its <a href="#Subframe_Properties">subframe properties</a> listed in the remaining columns. The table may be sorted by column by selecting a <a href="#Table_Sort_table_by_column">table sort column</a> and a <a href="#Table_Sort_Table_by_ordering">table sort ordering</a>.</p>
<p>The last two rows of the table display the medians and mean deviations of the <a href="#Subframe_Properties">subframe properties</a> across all subframes. Mean deviation is the mean absolute deviation from the median of the property.</p>
<p>On this table you can:</p>

<ul class="pidoc_list">
<li>Click on an item's checkbox to toggle its approved/rejected state. The subframe will also be locked.</li>
<li>View subframe full file paths as tool tip messages in the first column and subframe file names as tool tip mesages in the other columns.</li>
<li>View property definitions as tools tip messages of the blank row immediately below the row of the last subframe.</li>
</ul>

</dd>
<dt>
<p><a id="Table_Toggle_Selected"></a> Toggle Selected</p>
</dt>
<dd>
<p>Toggle the approved/rejected state of the currently selected subframes. The toggled subframes will also be locked.</p>
<p>Rejected subframes will be ignored during the output subframes process of SubframeSelector. The <a href="#subframe_approval_expression">subframe approval expression</a> will not modify the approved/rejected state of locked subframes.</p>
</dd>
<dt>
<p><a id="Table_Unlock_Selected"></a> Unlock Selected</p>
</dt>
<dd>
<p>Click this button unlock the currently selected subframes.</p>
</dd>
<dt>
<p><a id="Table_Save_Table_As"></a> Save Table As...</p>
</dt>
<dd>
<p>Click this button to save the table as a <em>comma separated value</em> .csv file for postprocessing.</p>
</dd>
<dt>
<p><a id="Table_Sort_table_by_column"></a> Sort table by column</p>
</dt>
<dd>
<p>This parameter specifies a table sort column.</p>
</dd>
<dt>
<p><a id="Table_Sort_Table_by_ordering"></a> Sort table by ordering</p>
</dt>
<dd>
<p>This parameter specifies a table sort ordering.</p>
</dd>
</dl>

</div>

<div class="pidoc_subsection" id="__Usage_:_Plots__">
   <h4 class="pidoc_subsectionTitle">2.6&emsp;<a id="Plots_section"></a>Plots</h4>
<img src="images/FWHM.png" alt=""/>

<dl class="pidoc_list">
<dt>
<p>Plot</p>
</dt>
<dd>
<p>The plot displays values of the selected plot ordinate. On the plot you can:</p>

<ul class="pidoc_list">
<li>Click a subframe's point to toggle its approved/rejected state. The subframe will also be locked.</li>
<li>Shift-click a subframe's point to unlock the subframe.</li>
</ul>

</dd>
<dt>
<p><a id="Plots_ordinate"></a> Ordinate</p>
</dt>
<dd>
<p>This parameter specifies the plot ordinate.</p>
</dd>
<dt>
<p><a id="Plots_Unlock_All"></a> Unlock All</p>
</dt>
<dd>
<p>Click this button to unlock all locked subframes.</p>
</dd>
<dt>
<p><a id="Plots_Save_Plots_As"></a> Save Plots As...</p>
</dt>
<dd>
<p>Click this button to save all plots in a multiple image FITS file.</p>
</dd>
</dl>

</div>

<div class="pidoc_subsection" id="__Usage_:_Output__">
   <h4 class="pidoc_subsectionTitle">2.7&emsp;<a id="Output_section"></a>Output</h4>
<img src="images/Output.png" alt=""/>

<dl class="pidoc_list">
<dt>
<p>Approved action</p>
</dt>
<dd>
<p>This parameter specifies the action applied to approved subframes by the <a href="#Output_Subframes_button">Output Subframes</a> button.</p>

<dl class="pidoc_list">
<dt>
<p>Copy</p>
</dt>
<dd>
<p>Approved subframes will be copied.</p>
</dd>
<dt>
<p>Move</p>
</dt>
<dd>
<p>Approved subframes will be moved.</p>
</dd>
<dt>
<p>None</p>
</dt>
<dd>
<p>No action will be applied to approved subframes.</p>
</dd>
</dl>

</dd>
<dt>
<p><a id="Output_Approved_directory"></a> Approved directory</p>
</dt>
<dd>
<p>This is the directory where all approved subframes will be copied or moved.</p>
<p>If this field is left blank, approved subframes will be copied or moved to the same directories as their corresponding target files.</p>
</dd>
<dt>
<p>Approved postfix</p>
</dt>
<dd>
<p>This is a postfix that will be appended to the file name of each copied or moved approved subframe.</p>
</dd>
<dt>
<p>Rejected action</p>
</dt>
<dd>
<p>This parameter specifies the action applied to rejected subframes by the <a href="#Output_Subframes_button">Output Subframes</a> button.</p>

<dl class="pidoc_list">
<dt>
<p>Copy</p>
</dt>
<dd>
<p>Rejected subframes will be copied.</p>
</dd>
<dt>
<p>Move</p>
</dt>
<dd>
<p>Rejected subframes will be moved.</p>
</dd>
<dt>
<p>None</p>
</dt>
<dd>
<p>No action will be applied to rejected subframes.</p>
</dd>
</dl>

</dd>
<dt>
<p><a id="Output_Rejected_directory"></a> Rejected directory</p>
</dt>
<dd>
<p>This is the directory where all rejected subframes will be copied or moved.</p>
<p>If this field is left blank, rejected subframes will be copied or moved to the same directories as their corresponding target files.</p>
</dd>
<dt>
<p>Rejected postfix</p>
</dt>
<dd>
<p>This is a postfix that will be appended to the file name of each copied or moved rejected subframe.</p>
</dd>
<dt>
<p>Star map directory</p>
</dt>
<dd>
<p>This is the directory where all subframe star map files will be written.</p>
<p>If this field is left blank, subframe star maps will be written to the same directories as their corresponding target files.</p>
</dd>
<dt>
<p>Star map postfix</p>
</dt>
<dd>
<p>This is a postfix that will be appended to the file name of each subfame star map.</p>
</dd>
<dt>
<p><a id="Output_Weight_keyword"></a> Weight keyword</p>
</dt>
<dd>
<p>This is the custom FITS keyword used to record subframe weights in copied subframes. Weights will not be recorded in moved subframes.</p>
<p>If this field is left blank, subframe weights will not be recorded.</p>
</dd>
<dt>
<p>Overwrite existing files</p>
</dt>
<dd>
<p>If this option is enabled the script will overwrite existing files with the same names as generated output files. This can be dangerous because the original contents of the overwritten files will be lost.</p>
<p><strong>Warning: Use this option <u>at your own risk</u></strong>.</p>
</dd>
<dt>
<p>On error</p>
</dt>
<dd>
<p>This parameter specifies what to do if there are errors during the measurement and output processes of SubframeSelector.</p>

<dl class="pidoc_list">
<dt>
<p>Continue</p>
</dt>
<dd>
<p>The process will continue with the next target subframe, if there is one.</p>
</dd>
<dt>
<p>Abort</p>
</dt>
<dd>
<p>The process will be aborted immediately after an error condition.</p>
</dd>
<dt>
<p>Ask user</p>
</dt>
<dd>
<p>A dialog box will be shown where you'll have to specify whether to continue or to abort the process.</p>
</dd>
</dl>

</dd>
</dl>

</div>

<div class="pidoc_subsection" id="__Usage_:_Measure__">
   <h4 class="pidoc_subsectionTitle">2.8&emsp;<a id="Measure_button"></a>Measure</h4>
<img src="images/MeasureButton.png" alt=""/>
<p>Click this button to measure the properties of the target subframes.</p>
</div>

<div class="pidoc_subsection" id="__Usage_:_Output_Subframes__">
   <h4 class="pidoc_subsectionTitle">2.9&emsp;<a id="Output_Subframes_button"></a>Output Subframes</h4>
<img src="images/OutputSubframesButton.png" alt=""/>
<p>Click this button to copy/move approved/rejected subframes to output directories. See the <a href="#Output_section">Output</a> section for information on file copy/move actions, output directories and file naming.</p>
</div>

<div class="pidoc_subsection" id="__Usage_:_Output_Maps__">
   <h4 class="pidoc_subsectionTitle">2.10&emsp;<a id="Output_Maps_button"></a>Output Maps</h4>
<img src="images/OutputMapsButton.png" alt=""/>
<p>Click this button to output star maps for all subframes to an output directory. See the <a href="#Output_section">Output</a> section for information on output directory and file naming.</p>
<p>A star map for a subframe consists of two files, a multi image FITs file and a <em>comma separated value</em> .csv file.</p>
<img style="margin-bottom:1em;" src="images/SubframeMap.png" alt=""/>
<img style="margin-bottom:1em;" src="images/SubframeFWHM.png" alt=""/>
<img src="images/SubframeEccentricity.png" alt=""/>
<p>The first image in the star map multi image FITS file is a map of the positions of the fitted stars in the subframe along with their sigma normalized and integer rounded fitting residuals. The sigma normalization is computed relative to the values of the subframe's <a href="#subframe_property_StarResidual">StarResidual</a> and <a href="#subframe_property_StarResidualMeanDev">StarResidualMeanDev</a> properites.</p>
<p>The second image shows the spatial variation of star profile <a href="#subframe_property_FWHM">FWHM</a> across the subframe.</p>
<p>The third shows the spatial variation of star profile <a href="#subframe_property_Eccentricity">Eccentricity</a> across the subframe.</p>
<p>The <em>comma separated value</em> value .csv file contains PSF model specific fitting parameters for each fitted star. See the documentation of the <a href="../../tools/DynamicPSF/DynamicPSF.html" title="../../tools/DynamicPSF/DynamicPSF.html">DynamicPSF</a> process for more information.</p>
</div>

<div class="pidoc_subsection" id="__Usage_:_Reset__">
   <h4 class="pidoc_subsectionTitle">2.11&emsp;Reset</h4>
<p>Click this button to reset all parameters to their default values.</p>
</div>

<div class="pidoc_subsection" id="__Usage_:_Dismiss__">
   <h4 class="pidoc_subsectionTitle">2.12&emsp;Dismiss</h4>
<p>Click this button to dismiss the script's dialog.</p>
</div>

   </div>
</div>

<div class="pidoc_section" id="__references__">
   <h3 class="pidoc_sectionTitle">References</h3>
   <div id="references">
      <p id="__reference_1__"><strong>[1]</strong> Jean-Luc Starck and Fionn Murtagh, <em>Automatic Noise Estimation from the Multiresolution Support</em>, Publications of the Royal Astronomical Society of the Pacific, vol. 110, February 1998, pp. 193-199</p>
      <p id="__reference_2__"><strong>[2]</strong> Moffat, A. F. J., <em>A Theoretical Investigation of Focal Stellar Images in the Photographic Emulsion and Application to Photographic Photometry</em>, Astronomy and Astrophysics, Vol. 3, p. 455 (1969)</p>
   </div>
</div>

<div class="pidoc_section" id="__related_tools__">
   <h3 class="pidoc_sectionTitle">Related Tools</h3>
   <div id="related_tools">
<p><a href="../../tools/DynamicPSF/DynamicPSF.html" title="../../tools/DynamicPSF/DynamicPSF.html">DynamicPSF</a>, <a href="../../tools/StarAlignment/StarAlignment.html" title="../../tools/StarAlignment/StarAlignment.html">StarAlignment</a>, <a href="../../tools/ImageIntegration/ImageIntegration.html" title="../../tools/ImageIntegration/ImageIntegration.html">ImageIntegration</a></p>
   </div>
</div>

<hr class="separator"/>

<div id="copyright">
   <p>Copyright &copy; 2012-2016 Mike Schuster. All Rights Reserved.</p>
</div>

<div id="footer">
   <p>Generated by the PixInsight Documentation Compiler script version 1.6.3 on 2018-12-04 19:24:27 UTC</p>
</div>
<br/>
<br/>

</div> <!-- contents -->

</body>
</html>
